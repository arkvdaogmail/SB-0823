<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Supabase File Management System</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Early error logging
        window.addEventListener('error', function(event) {
            console.error('Uncaught error:', event.error);
            alert('An error occurred: ' + event.error);
        });
    </script>
</head>
<body>
    <div id="errorDisplay" style="color: red; background-color: #ffeeee; padding: 10px;"></div>

    <!-- Rest of the previous HTML -->

    <script>
        // Add comprehensive error logging
        function logError(message, error) {
            console.error(message, error);
            const errorDisplay = document.getElementById('errorDisplay');
            if (errorDisplay) {
                errorDisplay.innerHTML += `<p>${message}: ${error ? error.toString() : 'Unknown error'}</p>`;
            }
            alert(message);
        }

        // Modify initialization to add error handling
        try {
            // Supabase configuration
            const SUPABASE_URL = 'https://mfrefbmnxygeahaluhzr.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1mcmVmYm1ueHlnZWFoYWx1aHpyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1NDIxOTUsImV4cCI6MjA2ODExODE5NX0.Ur3hl7rVEWk6U-ydNbKymFmXtxUlx6RTn0pU0EnP7u0';
            
            // Initialize Supabase client with error handling
            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
                auth: {
                    persistSession: true
                }
            });

            // Add error listener to Supabase client
            supabaseClient.on('error', (error) => {
                logError('Supabase Client Error', error);
            });

            // Rest of the previous script...

            // Add a global error handler for Supabase
            function handleSupabaseError(error) {
                console.error('Supabase Error:', error);
                const errorDisplay = document.getElementById('errorDisplay');
                if (errorDisplay) {
                    errorDisplay.innerHTML += `<p>Supabase Error: ${error.message}</p>`;
                }
            }

            // Modify existing functions to use error handling
            async function checkAuth() {
                try {
                    const { data, error } = await supabaseClient.auth.getSession();
                    
                    if (error) {
                        logError('Auth Session Error', error);
                        return;
                    }
                    
                    if (data.session) {
                        setStatus('Authenticated as ' + data.session.user.email, 'success');
                        enableUI();
                    } else {
                        setStatus('No active session', 'warning');
                    }
                } catch (error) {
                    logError('Check Auth Error', error);
                }
            }

            // Call checkAuth when script loads
            document.addEventListener('DOMContentLoaded', () => {
                console.log('DOM fully loaded and parsed');
                checkAuth();
            });

        } catch (globalError) {
            logError('Global Initialization Error', globalError);
        }
    </script>
</body>
</html>
